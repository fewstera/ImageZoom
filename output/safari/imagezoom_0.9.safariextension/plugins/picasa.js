// ==UserScript==
// @name Plugin
// @require js/jquery.min.js
// @all-frames true
// @include *://picasaweb.google.com/*
// @include *://picasaweb.google.ad/*
// @include *://picasaweb.google.ae/*
// @include *://picasaweb.google.com.af/*
// @include *://picasaweb.google.com.ag/*
// @include *://picasaweb.google.com.ai/*
// @include *://picasaweb.google.am/*
// @include *://picasaweb.google.it.ao/*
// @include *://picasaweb.google.com.ar/*
// @include *://picasaweb.google.as/*
// @include *://picasaweb.google.at/*
// @include *://picasaweb.google.com.au/*
// @include *://picasaweb.google.az/*
// @include *://picasaweb.google.ba/*
// @include *://picasaweb.google.com.bd/*
// @include *://picasaweb.google.be/*
// @include *://picasaweb.google.bg/*
// @include *://picasaweb.google.com.bh/*
// @include *://picasaweb.google.bi/*
// @include *://picasaweb.google.bj/*
// @include *://picasaweb.google.com.bn/*
// @include *://picasaweb.google.com.bo/*
// @include *://picasaweb.google.com.br/*
// @include *://picasaweb.google.bs/*
// @include *://picasaweb.google.co.bw/*
// @include *://picasaweb.google.com.by/*
// @include *://picasaweb.google.com.bz/*
// @include *://picasaweb.google.ca/*
// @include *://picasaweb.google.cd/*
// @include *://picasaweb.google.cf/*
// @include *://picasaweb.google.cg/*
// @include *://picasaweb.google.ch/*
// @include *://picasaweb.google.ci/*
// @include *://picasaweb.google.co.ck/*
// @include *://picasaweb.google.cl/*
// @include *://picasaweb.google.cn/*
// @include *://picasaweb.google.com.co/*
// @include *://picasaweb.google.co.cr/*
// @include *://picasaweb.google.com.cu/*
// @include *://picasaweb.google.cz/*
// @include *://picasaweb.google.de/*
// @include *://picasaweb.google.dj/*
// @include *://picasaweb.google.dk/*
// @include *://picasaweb.google.dm/*
// @include *://picasaweb.google.com.do/*
// @include *://picasaweb.google.dz/*
// @include *://picasaweb.google.com.ec/*
// @include *://picasaweb.google.ee/*
// @include *://picasaweb.google.com.eg/*
// @include *://picasaweb.google.es/*
// @include *://picasaweb.google.com.et/*
// @include *://picasaweb.google.fi/*
// @include *://picasaweb.google.com.fj/*
// @include *://picasaweb.google.fm/*
// @include *://picasaweb.google.fr/*
// @include *://picasaweb.google.ga/*
// @include *://picasaweb.google.ge/*
// @include *://picasaweb.google.gg/*
// @include *://picasaweb.google.com.gh/*
// @include *://picasaweb.google.com.gi/*
// @include *://picasaweb.google.gl/*
// @include *://picasaweb.google.gm/*
// @include *://picasaweb.google.gp/*
// @include *://picasaweb.google.gr/*
// @include *://picasaweb.google.com.gt/*
// @include *://picasaweb.google.gy/*
// @include *://picasaweb.google.com.hk/*
// @include *://picasaweb.google.hn/*
// @include *://picasaweb.google.hr/*
// @include *://picasaweb.google.ht/*
// @include *://picasaweb.google.hu/*
// @include *://picasaweb.google.co.id/*
// @include *://picasaweb.google.ie/*
// @include *://picasaweb.google.co.il/*
// @include *://picasaweb.google.im/*
// @include *://picasaweb.google.co.in/*
// @include *://picasaweb.google.is/*
// @include *://picasaweb.google.it/*
// @include *://picasaweb.google.je/*
// @include *://picasaweb.google.com.jm/*
// @include *://picasaweb.google.jo/*
// @include *://picasaweb.google.co.jp/*
// @include *://picasaweb.google.co.ke/*
// @include *://picasaweb.google.com.kh/*
// @include *://picasaweb.google.ki/*
// @include *://picasaweb.google.kg/*
// @include *://picasaweb.google.co.kr/*
// @include *://picasaweb.google.com.kw/*
// @include *://picasaweb.google.kz/*
// @include *://picasaweb.google.la/*
// @include *://picasaweb.google.com.lb/*
// @include *://picasaweb.google.li/*
// @include *://picasaweb.google.lk/*
// @include *://picasaweb.google.co.ls/*
// @include *://picasaweb.google.lt/*
// @include *://picasaweb.google.lu/*
// @include *://picasaweb.google.lv/*
// @include *://picasaweb.google.com.ly/*
// @include *://picasaweb.google.co.ma/*
// @include *://picasaweb.google.md/*
// @include *://picasaweb.google.me/*
// @include *://picasaweb.google.mg/*
// @include *://picasaweb.google.mk/*
// @include *://picasaweb.google.mn/*
// @include *://picasaweb.google.ms/*
// @include *://picasaweb.google.com.mt/*
// @include *://picasaweb.google.mu/*
// @include *://picasaweb.google.mv/*
// @include *://picasaweb.google.mw/*
// @include *://picasaweb.google.com.mx/*
// @include *://picasaweb.google.com.my/*
// @include *://picasaweb.google.co.mz/*
// @include *://picasaweb.google.com.na/*
// @include *://picasaweb.google.com.nf/*
// @include *://picasaweb.google.com.ng/*
// @include *://picasaweb.google.com.ni/*
// @include *://picasaweb.google.nl/*
// @include *://picasaweb.google.no/*
// @include *://picasaweb.google.com.np/*
// @include *://picasaweb.google.nr/*
// @include *://picasaweb.google.nu/*
// @include *://picasaweb.google.co.nz/*
// @include *://picasaweb.google.com.om/*
// @include *://picasaweb.google.com.pa/*
// @include *://picasaweb.google.com.pe/*
// @include *://picasaweb.google.com.ph/*
// @include *://picasaweb.google.com.pk/*
// @include *://picasaweb.google.pl/*
// @include *://picasaweb.google.pn/*
// @include *://picasaweb.google.com.pr/*
// @include *://picasaweb.google.ps/*
// @include *://picasaweb.google.pt/*
// @include *://picasaweb.google.com.py/*
// @include *://picasaweb.google.com.qa/*
// @include *://picasaweb.google.ro/*
// @include *://picasaweb.google.ru/*
// @include *://picasaweb.google.rw/*
// @include *://picasaweb.google.com.sa/*
// @include *://picasaweb.google.com.sb/*
// @include *://picasaweb.google.sc/*
// @include *://picasaweb.google.se/*
// @include *://picasaweb.google.com.sg/*
// @include *://picasaweb.google.sh/*
// @include *://picasaweb.google.si/*
// @include *://picasaweb.google.sk/*
// @include *://picasaweb.google.com.sl/*
// @include *://picasaweb.google.sn/*
// @include *://picasaweb.google.sm/*
// @include *://picasaweb.google.st/*
// @include *://picasaweb.google.com.sv/*
// @include *://picasaweb.google.td/*
// @include *://picasaweb.google.tg/*
// @include *://picasaweb.google.co.th/*
// @include *://picasaweb.google.com.tj/*
// @include *://picasaweb.google.tk/*
// @include *://picasaweb.google.tl/*
// @include *://picasaweb.google.tm/*
// @include *://picasaweb.google.to/*
// @include *://picasaweb.google.com.tr/*
// @include *://picasaweb.google.tt/*
// @include *://picasaweb.google.com.tw/*
// @include *://picasaweb.google.co.tz/*
// @include *://picasaweb.google.com.ua/*
// @include *://picasaweb.google.co.ug/*
// @include *://picasaweb.google.co.uk/*
// @include *://picasaweb.google.com.uy/*
// @include *://picasaweb.google.co.uz/*
// @include *://picasaweb.google.com.vc/*
// @include *://picasaweb.google.co.ve/*
// @include *://picasaweb.google.vg/*
// @include *://picasaweb.google.co.vi/*
// @include *://picasaweb.google.com.vn/*
// @include *://picasaweb.google.vu/*
// @include *://picasaweb.google.ws/*
// @include *://picasaweb.google.rs/*
// @include *://picasaweb.google.co.za/*
// @include *://picasaweb.google.co.zm/*
// @include *://picasaweb.google.co.zw/*
// @include *://picasaweb.google.cat/*
// ==/UserScript==

// Copyright (c) 2011 Romain Vallet <romain.vallet@gmail.com>
// Licensed under the MIT license, read license.txt

// The dynamic loading of images in Picasa Web Albums makes it difficult to handle with this extension.
// The function that "prepares" a link has been isolated (prepareImgLink) and is called whenever the
// user move the mouse over a link.

var hoverZoomPlugins = hoverZoomPlugins || [];
hoverZoomPlugins.push({
    name:'Picasa Web Albums',
    version:'0.6',
    prepareImgLinks:function (callback) {

        function prepareImgLink() {
            var _this = $(this), data = _this.data();
            if (data.hoverZoomSrc) {
                return;
            }
            var src = _this.find('img')[0].src;
            src = src.replace(/\/s\d+(-c)?\//, options.showHighRes ? '/s0/' : '/s800/');
            data.hoverZoomSrc = [src];
            _this.addClass('hoverZoomLink');

            var tooltip = _this.parent().find('.goog-icon-list-icon-meta:eq(0)');
            if (tooltip.length) {
                data.hoverZoomCaption = tooltip.text();
            }
        }

        function bindLinks() {
            $('a.goog-icon-list-icon-link,div.gphoto-grid-cell a').mouseover(prepareImgLink);
            bindLinksTimeout = null;
        }

        var bindLinksTimeout = setTimeout(bindLinks, 500);

        function windowOnDOMNodeInserted(event) {
            if (!bindLinksTimeout && event.srcElement && event.srcElement.nodeName == 'A') {
                bindLinksTimeout = setTimeout(bindLinks, 500);
            }
        }

        $(window).bind('DOMNodeInserted', windowOnDOMNodeInserted)
    }
});